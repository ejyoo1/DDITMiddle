<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
			PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
			"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="qna">

	<insert id="insertQnABoard" parameterClass="kr.or.ddit.qna.vo.QnABoardVO">
		insert into TB_QNA_BOARD (
			CODE
			, BOARD_SEQ
			, USER_ID
			, BOARD_TYPE
			, BOARD_TITLE
			, BOARD_CONTENT
			, BOARD_DATE
			<isNotEmpty property="boardSecret">
			, BOARD_SECRET
			</isNotEmpty>
			<isNotEmpty property="boardPw">
			, BOARD_PW
			</isNotEmpty>
			, BOARD_ANSWER
			, ATCH_FILE_ID
			,BOARD_HITS
			,BOARD_DELETE
			)
		values(
			'QNA'
			, SEQ_QNA_BOARD.NEXTVAL
			, 'yoonsung' <!-- 변경 필수 -->
			, 'INQUERY' <!-- 변경 필수 -->
			, #boardTitle#
			, #boardContent#
			, SYSDATE
			<isNotEmpty property="boardSecret">
			, #boardSecret#
			 </isNotEmpty>
			<isNotEmpty property="boardPw">
			, #boardPw#
			 </isNotEmpty>
			, 'N'
			, #atchFileId#
			, 0
			, 'N'
		)
	</insert>
	
	<update id="updateQnABoard" parameterClass="kr.or.ddit.qna.vo.QnABoardVO">
		update TB_QNA_BOARD
		   set BOARD_TITLE = #boardTitle#
		   		, BOARD_CONTENT = #boardContent#
		   		, BOARD_DATE = sysdate
		   		, BOARD_SECRET = #boardSecret#
				<isNotEmpty property="boardPw">
				, BOARD_PW = #boardPw#
		   		</isNotEmpty>
				<isNotEmpty property="atchFileId">
				, ATCH_FILE_ID = #atchFileId#
				</isNotEmpty>
		 where USER_ID = #userId#
		   and BOARD_SEQ = #boardSeq#
	</update>
	
	<delete id="deleteQnABoard" parameterClass="kr.or.ddit.qna.vo.QnABoardVO">
		update TB_QNA_BOARD
		set BOARD_DELETE = 'Y'
		where USER_ID = #userId# 
		and BOARD_SEQ = #boardSeq#
	</delete>
	
	<resultMap class="kr.or.ddit.qna.vo.QnABoardVO" id="qnaMap">
 		<result property="boardSeq" column="board_seq"/>
 		<result property="userId" column="user_id"/>
 		<result property="boardType" column="board_type"/>
 		<result property="boardTitle" column="board_title"/>
 		<result property="boardContent" column="board_content"/>
 		<result property="boardDate" column="board_date"/>
 		<result property="boardSecret" column="board_secret"/>
 		<result property="boardPw" column="board_pw"/>
 		<result property="boardAnswer" column="board_answer"/>
 		<result property="atchFileId" column="atch_file_id"/>
 		<result property="boardHits" column="board_hits"/>
 		<result property="boardDelete" column="board_delete"/>
 	</resultMap>
	
	<select id="getAllQnABoard" resultMap="qnaMap">
		select * 
		from TB_QNA_BOARD 
		where board_delete = 'N'
	</select>
	
	<!-- 조회수 -->
	<update id="countHitsQnABoard" parameterClass="String">
		update tb_qna_board
		set board_hits = (board_hits +1)
		where board_seq = #boardSeq#
	</update>
	
	<select id="getQnABoard" parameterClass="kr.or.ddit.qna.vo.QnABoardVO" resultMap="qnaMap">
		select * 
		from TB_QNA_BOARD
		where 1=1
		<isNotEmpty property="userId">
		and user_id = #userId#
		</isNotEmpty>
		<isNotEmpty property="boardSeq">
		and board_seq = #boardSeq#
		</isNotEmpty>
		<isNotEmpty property="boardTitle">
		and board_Title = #boardTitle#
		</isNotEmpty>
	</select>
	
	<select id="getQnA" parameterClass="String" resultMap="qnaMap">
		select * from TB_QNA_BOARD where board_seq = #boardSeq#
	</select>
</sqlMap>